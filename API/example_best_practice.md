# Лучшие практики при разработки API

API (Application programming interface) >> Программный интерфейс приложения.

API — это интерфейс для обмена данными. Слово «программный» означает, что API служат в первую очередь для взаимодействия программ: с системой взаимодействует не разработчик, а код, написанный им.

Программу, которая обращается к API с запросом, называют «клиент» (или client, если по-английски). Клиентом может быть код на сервере, мобильное приложение, программа для тестирования или даже обычный веб-браузер

Один из самых распространённых форматов передачи данных — это JSON.
JSON расшифровывается как JavaScript Object Notation (англ. «объектная запись JavaScript»)

## Принципы REST

Эти принципы ввёл Рой Филдинг в 2000 году в своей диссертации «Архитектурные стили и дизайн сетевых программных структур».

1. Клиент-сервер. Разделение ответственности между клиентом и сервером
Клиент и сервер отвечают за разные вещи. Ответственность клиента — пользовательский интерфейс, ответственность сервера — данные. Если API возвращает HTML-страницу, его нельзя назвать REST API: ведь при этом сервер берёт на себя ответственность за интерфейс.
2. Отсутствие состояния. Сервер не хранит состояние
Каждый запрос должен быть независимым, как будто он сделан в первый раз. Сервер не должен хранить какой-либо информации о клиенте. Каждый запрос клиента к серверу должен содержать всю информацию, необходимую для обработки этого запроса: кто запрашивает данные, какие данные запрашиваются.
3. Единый интерфейс
Интерфейс обращения к серверу одинаков для всех и не зависит от клиента. Запрос к данным может быть сформирован из браузера, мобильного приложения и с «умного» чайника по одним и тем же правилам.
4. Многоуровневость
Первый принцип гласит, что в коммуникации участвуют двое: клиент и сервер. Но можно строить более сложные системы, не нарушая этого принципа.
API сервиса Яндекс.Такси может использовать API Яндекс.Навигатора. Вы как клиент взаимодействуете только с API Яндекс.Такси, а он, в свою очередь, является клиентом навигатора. Здесь есть одно условие — каждый компонент должен видеть только свой уровень. Например, Яндекс.Навигатор не должен видеть все данные, которые вы отправили в Яндекс.Такси.
5. Кешируемость
Данные ответа могут быть закешированы. Это значит, что можно сохранить полученные данные на клиенте, а при идентичном запросе взять их из памяти клиента — кеша, а не ждать их с сервера. Нет смысла запрашивать данные повторно, если они никак не изменились.
6. Код по запросу
Этот принцип необязательный. Он гласит, что функциональность клиента может быть расширена кодом, приходящим с сервера. Сейчас такое можно встретить повсеместно: JavaScript используется для «оживления» страниц и исполнения каких-то сценариев на стороне клиента. Но принципы формулировались в 2000 году — тогда исполняемый код с сервера возвращали не так часто. Потому и выделили это в отдельный принцип.

## Критерии качества API

- Структурная целостность.<br>
API должно быть структурно целостные, складывать общую картину.
- Очевидность.<br>
В идеале, картину очевидную. Чтобы небыло загадок, и ручки в целом давали понять, что за запрос будет происходить.
- Консистентность.<br>
Если есть разные части эндпоинтов, то они должны быть похоже, что если пользователь апи понял кусочек апи, то в целом все остальное должно быть схоже и понятно.
- Читаемость.<br>
Легко читаться, как книга, в идеале. Читаешь, и в целом все понятно, что куда, создать карзину вот так, сделать что то вот так.
- Устойчивость к изменениям.<br>
Любая программа, любой код жив пока в нем можно что то менять. Должно быть таким, чтобы можно было бесконечно менять.

## Структура и иерархия

- Слабая связность разных сущностей.
- Представление высокоуровневых абстраций.
- Изоляции уровней абстрации, взаимодействие только с соседними слоями.
- Разграничение областей ответственности.

## Именование эндпоинтов

Чтобы с вашим API было просто и удобно общаться — соблюдайте простые правила.
Ресурсы — существительные

- Из записи METHOD + url, должно быть понятно, что делает операция

```ruby
+   ПЛОХО                   +   ХОРОШО
+------------------------------------------------+
+   POST/order/status       +   POST/order/cancel  # ручка для отмены заказа
+   PUT/order               +   GET/order/cancellation-status  # получить у конкр. заказа статус отмены
+   PATCH/order             +   GET/order/status  #  получить статус заказа 
+   GET/order/cancellation  +
+------------------------------------------------+
```

GET - кешированный запрос. Нельзя использовать GET для модификаций на бэке запросов.

## Именование сущностей

- Не использовать одиночные слова без определенной семантики

```yml
+   ПЛОХО       +   ХОРОШО
+------------------------------------------------+
+   get         +   get_id
+   set         +   set_date
+   call        +   call_timestamp
+   apply       +   apply_discount
+------------------------------------------------+
```

- Не использовать сокращения в именовании, кроме устоявшихся (str(string), tpl(template), ts(timestamp), ms(milliseconds))

- Не передовать числа с плавающей запятой, могут быть проблемы.
- - Как передавать тогда?
- - - Если Json, то можно использовать обходные так сказать пути:
<br> Например:

```bash
integer: {
    "price": 3,
    "divisor": 10
}
# or
sting: {  # так проще и практичнее. Почему? Json и так текст...
    "price": "0.3"
}
```

- - .
- .

## Идентификаторы

- Лучше использовать глобально уникальные идетификаторы (например uuid)

```ruby
item_id = 3125e1as54d41e21asd415624e3a12sd
user_id = qw21edc8431e1dq6w51d1625w1d3q
oreder_id = q1we152431dsa56d431123211e516d5411d
```

- если сложно так различать и эти айдишки например лежат в одной таблицу по какой то там причине/архитектура, то можно добавить пространство имён, но это уже будет не ```uid```, а ```строка```.

```bash
item_id = item:3125e1as54d41e21asd415624e3a12sd
user_id = user:qw21edc8431e1dq6w51d1625w1d3q
oreder_id = order:q1we152431dsa56d431123211e516d5411d
```

- не использовать в заказах например всяких и тп, автоинкремент (id-шки), потому что тебя легко можно будет просканить, посмотреть запрос в 8 утра, сделать заказ, и увидеть id заказа 1000, а вечером, id 2000, то легко снять аналитику по заказам в день и тп.

## Набор рекомендаций и правил

- Пустой ответ, может и должен быть 200. Пустой ответ не является ошибочный.

- Атомарность
